---
title: 'Terraform+Swagger+APIGateway+Lambdaã§å§‹ã‚ã‚‹çˆ†é€ŸAPIé–‹ç™º'
emoji: 'ğŸ˜»'
type: 'tech'
topics: ['Terraform', 'APIGateway', 'lambda', 'Swagger']
published: false
---

# ã¯ã˜ã‚ã«

## æœ¬è¨˜äº‹ã§ã¯ä»¥ä¸‹ã® API ã‚’ã—ã¾ã™

ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```
$ curl https://<domainname>/users/hoge
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
$ {message:your name is hoge}
```

## æœ¬è¨˜äº‹ã¯ä»¥ä¸‹ã®é †åºã§èª¬æ˜ã—ã¾ã™

1. Terraform ã¨ Swagger ã®ã¿ã§ API ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’æ§‹ç¯‰ã—ã¾ã™
2. API ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ãŒå—ã‘å–ã£ãŸå…¥åŠ›ã‚’ Lambda ã«æ¸¡ã—ã¾ã™
3. Lambda ã®å‡ºåŠ›ã‚’ API ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã«è¿”ã—ã¾ã™

# Terraform ã§ APIGateway ãƒªã‚½ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã‚ˆã†

- APIGateway ã‚’å®£è¨€ã—ã¾ã™
- body ã« Swagger ã® YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»£å…¥ã—ã¾ã™

```js
resource "aws_api_gateway_rest_api" "api" {
  name        = "MyAPIGateway"
  description = "Created by Terraform"
  body        = data.template_file.swagger.rendered
  endpoint_configuration {
    types = ["REGIONAL"]
  }
}
```

- Swagger ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ Terraform ã§èª­ã¿è¾¼ã¿ã¾ã™

:::message
Swagger ãƒ•ã‚¡ã‚¤ãƒ«ã¯ Terraform ã‹ã‚‰ã¯èª­ã¿å–ã‚Šå°‚ç”¨ã¨ãªã‚‹ã®ã§ data ãƒªã‚½ãƒ¼ã‚¹ã¨ã—ã¦å®£è¨€ã—ã¾ã™ï½¡
[å‚è€ƒ](https://docs.usacloud.jp/terraform-v1/configuration/resources/data_resource/)
:::

```js
data "template_file" "swagger" {
  // fileé–¢æ•°ã§YAMLã‚’èª­ã¿è¾¼ã¿
  template = file("./swagger.yml")
  // swagger.ymlå†…ã§å‘¼ã³å‡ºã™å¤‰æ•°ã‚’æ¸¡ã™
  vars = {
    title                   = "MyAPIGateway"
    aws_region_name         = "ap-northeast-1"
    get_lambda_function_arn = var.testfunction_arn
    set_lambda_function_arn = data.aws_lambda_alias.set_function_prod.arn
  }
}
```
